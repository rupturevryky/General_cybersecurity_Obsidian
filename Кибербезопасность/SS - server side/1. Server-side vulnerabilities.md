## What is access control?

Контроль доступа — это применение ограничений на то, кто или что уполномочено выполнять действия или получать доступ к ресурсам. В контексте веб-приложений контроль доступа зависит от аутентификации и управления сессиями:

- **Аутентификация** подтверждает, что пользователь — тот, за кого себя выдаёт.
- **Управление сессией** определяет, какие последующие HTTP-запросы выполняются этим же пользователем.
- **Контроль доступа** определяет, разрешено ли пользователю выполнить действие, которое он пытается выполнить.

---

### Вертикальная эскалация привилегий

Если пользователь может получить доступ к функционалу, к которому ему не разрешено, это и есть вертикальное повышение привилегий. Например, если пользователь без административного права может получить доступ к странице администратора, где он может удалить учетные записи, это вертикальное повышение привилегий.

Представьте приложение, которое размещает административные функции по следующему URL:

`https://insecure-website.com/administrator-panel-yb556`

Это может быть непредсказуемо напрямую атакующим. Однако приложение всё равно может утекать URL пользователям. URL может быть раскрыт в JavaScript, который строит пользовательский интерфейс на основе роли пользователя:

```
<script> var isAdmin = false; 
	if (isAdmin) { 
		... 
		var adminPanelTag = document.createElement('a'); 
		adminPanelTag.setAttribute('href', 'https://insecure-website.com/administrator-panel-yb556'); 
		adminPanelTag.innerText = 'Admin panel'; 
		... 
	} 
</script>
```

---

#### Методы контроля доступа на основе параметров

Некоторые приложения определяют права доступа или роль пользователя при входе, а затем хранят эту информацию в контролируемом для пользователя месте. Это может быть:

- Скрытое поле.
- Cookie.
- Параметр строки заданного запроса.

Приложение принимает решения по контролю доступа на основе представленного значения. Например:

```
https://insecure-website.com/login/home.jsp?admin=true 
https://insecure-website.com/login/home.jsp?role=1
```

Этот подход небезопасен, потому что пользователь может изменять значение и доступ к функциям, на которые он не уполномочен, например, административных функций.

---

### Эскалация горизонтальных привилегий

Горизонтальное повышение привилегий происходит, если пользователь получает доступ к ресурсам, принадлежащим другому пользователю, а не к собственным ресурсам этого типа. Например, если сотрудник может получить доступ к записям других сотрудников, а также к своим собственным, это и есть горизонтальное повышение привилегий.

Горизонтальные атаки с эскалацией привилегий могут использовать аналогичные методы эксплойта, как вертикальная эскалация привилегий. Например, пользователь может зайти на свою страницу аккаунта по следующему URL:

```
https://insecure-website.com/myaccount?id=123
```

Если злоумышленник изменяет значение параметра `id` на значение другого пользователя, он может получить доступ к странице аккаунта другого пользователя, а также к соответствующим данным и функциям. 
 
> [!info] Примечание
> Это пример уязвимости небезопасной прямой ссылки на объект (IDOR). Такой тип уязвимости возникает, когда значения параметров пользователя-контроллера используются для прямого доступа к ресурсам или функциям.

В некоторых приложениях используемый параметр не имеет предсказуемого значения. Например, вместо увеличивающегося числа приложение может использовать глобально уникальные идентификаторы (GUID) для идентификации пользователей. Это может помешать злоумышленнику угадать или предсказать идентификатор другого пользователя. Однако GUID, принадлежащие другим пользователям, могут быть раскрыты в других частях приложения, где на них ссылаются, например, в сообщениях пользователя или отзывах.

---

## Authentication vulnerabilities

---

### В чём разница между аутентификацией и авторизацией?

Аутентификация — это процесс подтверждения, что пользователь — это тот, за кого он себя выдаёт. Авторизация включает проверку, разрешено ли пользователю что-либо делать.

Например, аутентификация определяет, действительно ли пытающийся получить доступ к сайту с этим именем `Carlos123`, тот же человек, который создал аккаунт. 

После аутентификации их права определяют, на что им разрешено. Например, им может быть разрешено получать доступ к личной информации других пользователей или выполнять действия, например, удаление учетной записи другого пользователя. 

---

### Атаки грубой силой

Атака методом перебора — это когда злоумышленник использует систему проб и ошибок для угадывания действительных пользователей. Эти атаки обычно автоматизируются с помощью списков слов с именами пользователей и паролями. Автоматизация этого процесса, особенно с использованием специализированных инструментов, потенциально позволяет злоумышленнику совершать огромное количество попыток входа на высокой скорости.

Brute-forcing — это не всегда просто случайные догадки по именам пользователей и паролям. Используя базовую логику или общедоступные знания, злоумышленники могут тонко настраивать атаки методом перебора для более обоснованных предположений. Это значительно повышает эффективность таких атак. Сайты, которые используют вход по паролю как единственный способ аутентификации пользователей, могут быть крайне уязвимыми, если не реализуют достаточную защиту методом перебора.

---

### Обход двухфакторной аутентификации

Иногда реализация двухфакторной аутентификации настолько ошибочна, что её можно полностью обойти.

Если сначала пользователя просят ввести пароль, а затем ввести код подтверждения на отдельной странице, он фактически находится в состоянии «войдённого» до того, как введёт код подтверждения. В таком случае стоит проверить, можно ли сразу перейти к страницам «только для входа» после первого этапа аутентификации. Иногда вы обнаружите, что сайт на самом деле не проверяет, выполнили ли вы второй шаг перед загрузкой страницы.

---

## Что такое OS command injection?

Инъекция команд в ОС также известна как shell injection. Она позволяет злоумышленнику выполнять команды операционной системы (ОС) на сервере, на котором запущено приложение, и обычно полностью скомпрометировать приложение и его данные. Часто злоумышленник может использовать уязвимость инъекции команд ОС для компрометации других частей хостинговой инфраструктуры и использовать доверительные отношения для перенаправления атаки на другие системы внутри организации.

---

### Полезные команды

После выявления уязвимости при инъекции команд в ОС полезно выполнить несколько начальных команд для получения информации о системе. Ниже приведено краткое изложение некоторых команд, полезных на платформах Linux и Windows:

|Цель командования|Linux|Windows|
|---|---|---|
|Имя текущего пользователя|`whoami`|`whoami`|
|Операционная система|`uname -a`|`ver`|
|Конфигурация сети|`ifconfig`|`ipconfig /all`|
|Сетевые соединения|`netstat -an`|`netstat -an`|
|Запущенные процессы|`ps -ef`|`tasklist`|